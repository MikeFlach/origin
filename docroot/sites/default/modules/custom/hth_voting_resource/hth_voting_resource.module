<?php
// $Id$

function hth_voting_resource_services_resources() {
  return array(
   'vote' => array(
     'retrieve' => array(
       'help' => 'Retrieves vote count for a given hth/nid/day',
       'file' => array('file' => 'inc', 'module' => 'hth_voting_resource'),
       'callback' => '_hth_voting_resource_retreive',
       'access callback' =>  '_hth_voting_resource_access',
       'args' => array(
         array(
           'name' => 'composit_data',
           'type' => 'string',
           'description' => 'The nid of the hth + "~" + uuid',
           'source' => array('path' => '0'),
           'optional' => FALSE,
         ),
       ),
     ),
     'create' => array(
       'help' => 'Creates a vote for a given hth/nid/day',
       'file' => array('file' => 'inc', 'module' => 'hth_voting_resource'),
       'callback' => '_hth_voting_resource_create',
       'access callback' => '_hth_voting_resource_access',
       'args' => array(
         array(
           'name' => 'data',
           'type' => 'array',
           'description' => 'The hth nid/user id',
           'source' => 'data',
           'optional' => FALSE,
         ),
       ),
     ),
   ),
  );
}

function _hth_voting_resource_access($args) {
  return true;
}

function hth_voting_resource_block_info() {
  $contest_week = variable_get('hth_contest_week', 0);

  $blocks['hth_nav_header'] = array(
    'info' => t("Header with links above/below all hometown hottie pages. Current Week ($contest_week)")
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function hth_voting_resource_block_view($delta = '') {
  $contest_week = variable_get('hth_contest_week', 0);
  $voting_open = 1;

  $weeks = '';
  if ($contest_week == 1) {
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2" class="future-week">2</li><li id="hottie-head-3" class="future-week">3</li><li id="hottie-head-4" class="future-week">4</li><li id="hottie-head-5" class="future-week">5</li><li id="hottie-head-semis" class="future-week">Semis</li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }
  elseif ($contest_week == 2) {
    $weeks = '<li id="hottie-head-1""><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3" class="future-week">3</li><li id="hottie-head-4" class="future-week">4</li><li id="hottie-head-5" class="future-week">5</li><li id="hottie-head-semis" class="future-week">Semis</li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }
  elseif ($contest_week == 3) {
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3"><a href="/hometown-hotties/2013/week3">3</a></li><li id="hottie-head-4" class="future-week">4</li><li id="hottie-head-5" class="future-week">5</li><li id="hottie-head-semis" class="future-week">Semis</li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }
  elseif ($contest_week == 4) {
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3"><a href="/hometown-hotties/2013/week3">3</a></li><li id="hottie-head-4"><a href="/hometown-hotties/2013/week4">4</a></li><li id="hottie-head-5" class="future-week">5</li><li id="hottie-head-semis" class="future-week">Semis</li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }
  elseif ($contest_week == 5) {
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3"><a href="/hometown-hotties/2013/week3">3</a></li><li id="hottie-head-4"><a href="/hometown-hotties/2013/week4">4</a></li><li id="hottie-head-5"><a href="/hometown-hotties/2013/week5">5</a></li><li id="hottie-head-semis" class="future-week">Semis</li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }
  elseif ($contest_week == 'semi_finals') {
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3"><a href="/hometown-hotties/2013/week3">3</a></li><li id="hottie-head-4"><a href="/hometown-hotties/2013/week4">4</a></li><li id="hottie-head-5"><a href="/hometown-hotties/2013/week5">5</a><li id="hottie-head-semis" class="finals-selected"><a href="/hometown-hotties/2013/Semis">Semis</a></li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }
  elseif ($contest_week == 'finals') {
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3"><a href="/hometown-hotties/2013/week3">3</a></li><li id="hottie-head-4"><a href="/hometown-hotties/2013/week4">4</a></li><li id="hottie-head-5"><a href="/hometown-hotties/2013/week5">5</a><li id="hottie-head-semis"><a href="/hometown-hotties/2013/Semis">Semis</a></li><li id="hottie-head-finals" class="finals-selected"><a href="/hometown-hotties/2013/finals">finals</a></li>';
  } else {
    $voting_open = 0;
    $weeks = '<li id="hottie-head-1"><a href="/hometown-hotties/2013/week1">1</a></li><li id="hottie-head-2"><a href="/hometown-hotties/2013/week2">2</a></li><li id="hottie-head-3"><a href="/hometown-hotties/2013/week3">3</a></li><li id="hottie-head-4"><a href="/hometown-hotties/2013/week4">4</a></li><li id="hottie-head-5"><a href="/hometown-hotties/2013/week5">5</a></li><li id="hottie-head-semis" class="future-week">Semis</li><li id="hottie-head-finals" class="future-week">Finals</li>';
  }

  $header_txt = '<div id="hth_header_container"><div class="hottie-header"><a href="/hometown-hotties/2013"><img src="http://cdn2.maxim.com/maxim/sites/default/files/hotties/hth_2013_header2.png" /></a></div>';
  if (strlen($weeks) > 0) {
    if ($voting_open == 1) {
      $vote_title = 'VOTING WEEK:';
    } else {
      $vote_title = 'WEEK:';
    }
    $header_txt .= '<ul id="hth_header"><li class="first-element">' . $vote_title . '</li>'.$weeks.'</ul>';
  }
  $header_txt .= '</div><div style="clear: both"></div> ';

  // <li class="last-element"><a href="/girls/hometown-hotties">HOTTIES CENTRAL</a></li>

  $block = array();
  if ($delta == 'hth_nav_header') {
    $block['subject'] = t('');
    $block['content'] = array(
      '#markup' => $header_txt,
      '#title' => t(''),
    );
  }

  $js=<<<JS
    jQuery(function(){
      if (typeof Drupal.settings.Maxim.hottie.hottie_year !== "undefined" && typeof Drupal.settings.Maxim.hottie.hottie_week !== "undefined") {
        if (Drupal.settings.Maxim.hottie.hottie_year == 2013) {
          jQuery("#hth_header").show();
          jQuery("#hottie-head-" + Drupal.settings.Maxim.hottie.hottie_week).addClass('hth_h_selweek');
        }
      }
    });
JS;

  drupal_add_js($js, array('type' => 'inline', 'scope' => 'header'));
  return $block;
}
