<?php
// $Id$

function hth_voting_resource_services_resources() {
  return array(
   'vote' => array(
     'retrieve' => array(
       'help' => 'Retrieves vote count for a given hth nid',
       'file' => array('file' => 'inc', 'module' => 'hth_voting_resource'),
       'callback' => '_hth_voting_resource_create',
       'access callback' =>  '_hth_voting_resource_access',
       'args' => array(
         array(
           'name' => 'nid',
           'type' => 'int',
           'description' => 'The nid of the hth + ":::::" + uuid',
           'source' => array('path' => '0'),
           'optional' => FALSE,
         ),
       ),
     ),/*
     'create' => array(
       'help' => 'Creates a vote for a given hth nid',
       'file' => array('file' => 'inc', 'module' => 'hth_voting_resource'),
       'callback' => '_hth_voting_resource_create',
       'access callback' => '_hth_voting_resource_access',
       'args' => array(
         array(
           'name' => 'data',
           'type' => 'array',
           'description' => 'The hth nid/user id',
           'source' => 'data',
           'optional' => FALSE,
         ),
       ),
     ),*/
   ),
  );
}

function _hth_voting_resource_access($args) {
  return true;
}

function voteresource_perm() {
  return array(
    'hth_voting_resource resource vote count',
  );
}

function hth_voting_resource_get_vote_count($nid) {
  $criteria = array();
  $criteria['entity_id'] = $nid;

  $vote_count = votingapi_select_votes($criteria);

  return ($vote_count);
}

function hth_voting_resource_write_vote($vote_data) {
  $vote = array();
  $criteria = array();

  $vote['entity_type'] = 'node';
  $vote['value_type'] = 'points';
  $vote['entity_id'] = $vote_data['nid'];
  $vote['value'] = 1;
  $vote['uid'] = $vote_data['uid'];
  $vote['tag'] = 'vote';

  $votingapi_set_votes = votingapi_set_votes($vote, $criteria);
   return($vote_data['uid']);
  if (is_array($votingapi_set_votes)) {
    return (1);
  }
  else {
    return (services_error('Error adding vote', 406));
  }
}

function hth_voting_resource_block_info() {
  $contest_week = variable_get('hth_contest_week', 0);

  $blocks['hth_nav_header'] = array(
    'info' => t("Header with links above/below all hometown hottie pages. Current Weel($contest_week)")
  );

  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function hth_voting_resource_block_view($delta = '') {
  $contest_week = variable_get('hth_contest_week', 0);

  $weeks = '';
  if ($contest_week == 1) {
    $weeks = '<span id="hth_h_selweek">1</span><a href="/hometown-hotties/2013/week2">2</a><a href="/hometown-hotties/2013/week3">3</a><a href="/hometown-hotties/2013/week4">4</a><a href="/hometown-hotties/2013/week5">5</a><a href="/hometown-hotties/2013/semis">semis</a> <a href="/hometown-hotties/2013/finals">finals</a>';
  }
  elseif ($contest_week == 2) {
    $weeks = '<a href="/hometown-hotties/2013/week1">1</a><span id="hth_h_selweek">2</span><a href="/hometown-hotties/2013/week3">3</a><a href="/hometown-hotties/2013/week4">4</a><a href="/hometown-hotties/2013/week5">5</a><a href="/hometown-hotties/2013/semis">semis</a> <a href="/hometown-hotties/2013/finals">finals</a>';
  }
  elseif ($contest_week == 3) {
    $weeks = '<a href="/hometown-hotties/2013/week1">1</a><a href="/hometown-hotties/2013/week2">2</a><span id="hth_h_selweek">3</span><a href="/hometown-hotties/2013/week4">4</a><a href="/hometown-hotties/2013/week5">5</a><a href="/hometown-hotties/2013/semis">semis</a> <a href="/hometown-hotties/2013/finals">finals</a>';
  }
  elseif ($contest_week == 4) {
    $weeks = '<a href="/hometown-hotties/2013/week1">1</a><a href="/hometown-hotties/2013/week2">2</a><a href="/hometown-hotties/2013/week3">3</a><span id="hth_h_selweek">4</span><a href="/hometown-hotties/2013/week5">5</a><a href="/hometown-hotties/2013/semis">semis</a> <a href="/hometown-hotties/2013/finals">finals</a>';
  }
  elseif ($contest_week == 5) {
    $weeks = '<a href="/hometown-hotties/2013/week1">1</a><a href="/hometown-hotties/2013/week2">2</a><a href="/hometown-hotties/2013/week3">3</a><a href="/hometown-hotties/2013/week4">4</a><span id="hth_h_selweek">5</span><a href="/hometown-hotties/2013/semis">semis</a><a href="/hometown-hotties/2013/finals">finals</a>';
  }
  elseif ($contest_week == 'semifinals') {
    $weeks = '<a href="/hometown-hotties/2013/week1">1</a><a href="/hometown-hotties/2013/week2">2</a><a href="/hometown-hotties/2013/week3">3</a><a href="/hometown-hotties/2013/week4">4</a><a href="/hometown-hotties/2013/week5">5</a><span id="hth_h_selweek">semis</span><a href="/hometown-hotties/2013/finals">finals</a>';
  }
  elseif ($contest_week == 'finals') {
    $weeks = '<a href="/hometown-hotties/2013/week1">1</a><a href="/hometown-hotties/2013/week2">2</a><a href="/hometown-hotties/2013/week3">3</a><a href="/hometown-hotties/2013/week4">4</a><a href="/hometown-hotties/2013/week5">5</a><a href="/hometown-hotties/2013/semis">semis</a><span id="hth_h_selweek">finals</span>';
  }

  $header_txt = '<div id="hth_header"><a href="/hometown-hotties-entry-form-2013">ENTRY FORM</a> | VOTING WEEK:'.$weeks.'<a href="/girls/hometown-hotties">HOTTIES CENTRAL</a></div>';

  $block = array();
  if ($delta == 'hth_nav_header') {
    $block['subject'] = t('Hometown Hotties');
    $block['content'] = array(
      '#markup' => $header_txt,
      '#title' => t(''),
    );
  }
  return $block;
}

